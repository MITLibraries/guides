<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Legacy Terraform &#8212; Guides  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pantheon" href="pantheon.html" />
    <link rel="prev" title="Legacy AWS" href="legacy-aws.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="legacy-terraform">
<h1>Legacy Terraform<a class="headerlink" href="#legacy-terraform" title="Link to this heading">¶</a></h1>
<p>This contains most of the documentation for how we use Terraform here. The primary repository is located at <a class="reference external" href="https://github.com/MITLibraries/mitlib-terraform">https://github.com/MITLibraries/mitlib-terraform</a> but there are other repos in the org that provide modules.</p>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h2>
<p>For all new TF work you should be using version 0.12. We make heavy use of workspaces to manage deploying to different environments. The first thing you should do is set the <code class="docutils literal notranslate"><span class="pre">TF_WORKSPACE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">stage</span></code>. You should make this change persistent in whatever way you manage environment variables on your system. The easiest way to do this is to add the following to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file (if you use bash):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">TF_WORKSPACE</span><span class="o">=</span><span class="n">stage</span>
</pre></div>
</div>
<p>However you choose to do this, <em>it should be the first thing you do.</em> Making this change will ensure you aren’t accidentally deploying to production.</p>
</section>
<section id="workspaces">
<h2>Workspaces<a class="headerlink" href="#workspaces" title="Link to this heading">¶</a></h2>
<p>We use <code class="docutils literal notranslate"><span class="pre">stage</span></code> and <code class="docutils literal notranslate"><span class="pre">prod</span></code> workspaces. If you have followed the instructions you should be deploying to the staging workspace by default. You can simply run <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">plan</span></code> and <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code> and it will deploy to staging.</p>
<p>When you are ready to deploy to production you will need to explicitly specify the <code class="docutils literal notranslate"><span class="pre">prod</span></code> workspace. Rather than changing the <code class="docutils literal notranslate"><span class="pre">TF_WORKSPACE</span></code> envvar for your entire session, the recommended practice is to change it only for the command you are running. This may vary depending on which shell you are using. For bash, you would do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ TF_WORKSPACE=prod terraform plan
</pre></div>
</div>
<p>Doing things this way keeps it explicit about deploying to production.</p>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h2>
<p>Our current TF config uses quite a few external modules. This is a decision that has not aged well. TF modules are an acceptable solution, but the advice given in <a class="reference external" href="https://www.terraform.io/docs/modules/index.html#when-to-write-a-module">the Terraform documentation</a> should be followed. In general, if you are just wrapping a handful of AWS resources, don’t use a module; it’s better to just copy and paste. If you are using an external module make sure you are linking to a specific release and not just the master branch.</p>
</section>
<section id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Link to this heading">¶</a></h2>
<p>If there are differences between staging and production, or you have secrets that need to be included, you should use TF variables. Include <code class="docutils literal notranslate"><span class="pre">prod.tfvars</span></code> and <code class="docutils literal notranslate"><span class="pre">stage.tfvars</span></code> files in your config. These should not be checked into version control. The main repo is currently set to ignore all <code class="docutils literal notranslate"><span class="pre">.tfvars</span></code> files.</p>
<p>We don’t have a great solution for sharing these variables yet. Until a better solution can be set up, you will need to manually sync these variables to the <code class="docutils literal notranslate"><span class="pre">mit-tfvars</span></code> S3 bucket. The structure of this bucket should mimic the structure of the main repo.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Guides</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/a11y.html">Accessibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github_desktop.html">GitHub Desktop</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How We Work Together</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/code_review.html">Code review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/pairing.html">Pair programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Languages and Frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../languages/python.html">Python Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/rails.html">Rails at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/vuejs.html">Vue.js at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/wordpress.html">WordPress at MIT Libraries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Authentication</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authentication/oauth.html">OAuth at MIT (deprecated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authentication/touchstone_saml.html">Touchstone / Shibboleth / SAML</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="aws-2.0.html">AWS Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="cicd.html">Continuous Integration/Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="heroku.html">Heroku</a></li>
<li class="toctree-l1"><a class="reference internal" href="heroku_checklist.html">Heroku Launch Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="legacy-aws.html">Legacy AWS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Legacy Terraform</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workspaces">Workspaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variables">Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pantheon.html">Pantheon</a></li>
<li class="toctree-l1"><a class="reference internal" href="terraform-1.0.html">Terraform</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Everything else</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/adr.html">Architecture Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/diagrams.html">Diagramming Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/docker.html">Containerizing Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/exception_monitoring.html">Exception Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/incident_response.html">Incident Response Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/logging.html">Central Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/matomo.html">Configuring apps to use Matomo for analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/proxy_urls.html">Proxy URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ssl.html">SSL Encryption</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="legacy-aws.html" title="previous chapter">Legacy AWS</a></li>
      <li>Next: <a href="pantheon.html" title="next chapter">Pantheon</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, MIT Libraries.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/deploy/legacy-terraform.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>