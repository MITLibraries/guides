
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Containerizing Your App &#8212; Guides  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exception Monitoring" href="exception_monitoring.html" />
    <link rel="prev" title="Diagramming Guidelines" href="diagrams.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="containerizing-your-app">
<h1>Containerizing Your App<a class="headerlink" href="#containerizing-your-app" title="Permalink to this headline">¶</a></h1>
<p>This will provide some guidelines for getting your application ready for containers. This is mostly relevant for custom software, as existing solutions will (hopefully) already have a Dockerfile.</p>
<section id="dockerfile-guidelines">
<h2>Dockerfile Guidelines<a class="headerlink" href="#dockerfile-guidelines" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Keep your Dockerfile simple. If you have complicated logic that needs to be done, put it in a shell script and call it from your Dockerfile.</p></li>
<li><p>Specify the minor language version in your base image, e.g. <code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">python:3.6</span></code>.</p></li>
<li><p>Use both an ENTRYPOINT and CMD (more on this below).</p></li>
<li><p>EXPOSE a port if you are deploying a web app. This is good documentation more than anything else.</p></li>
<li><p>Leave environment variables out of your Dockerfile. These should be set at run time through the orchestration framework.</p></li>
<li><p>Use COPY instead of ADD (unless you really need ADD).</p></li>
</ol>
</section>
<section id="entrypoint-cmd">
<h2>ENTRYPOINT/CMD<a class="headerlink" href="#entrypoint-cmd" title="Permalink to this headline">¶</a></h2>
<p>Deciding how and when to use ENTRYPOINT and CMD can be confusing. The suggested usage made here is done for clarity of intent and most predictable behavior. Each Dockerfile should have both an ENTRYPOINT and CMD. Think of your ENTRYPOINT as your application’s main command and the CMD as the most common arguments. A few examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;bundle&quot;</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;rails&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;3000&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;gunicorn&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.wsgi&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0:5000&quot;</span><span class="p">,</span> <span class="s2">&quot;-w&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Specifying both an ENTRYPOINT and CMD clearly communicates to anyone looking at this how the app should be run. This also makes it easier to run since a simple <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command will execute the ENTRYPOINT with CMD as the arguments. Both can still be changed at run time if needed; consider ENTRYPOINT and CMD as your defaults.</p>
<p>You may also sometimes see these options used with a slightly different syntax, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ENTRYPOINT</span> <span class="n">bundle</span> <span class="n">exec</span>
</pre></div>
</div>
<p>Note how <code class="docutils literal notranslate"><span class="pre">bundle</span> <span class="pre">exec</span></code> is not specified as an array. The simplest suggestion is don’t do this. Using an array, as shown in the earlier examples, will almost always lead to fewer unexpected issues.</p>
</section>
<section id="dockerignore">
<h2>.dockerignore<a class="headerlink" href="#dockerignore" title="Permalink to this headline">¶</a></h2>
<p>In most cases, your Dockerfile will be copying much of your project’s source directory into the container. Copying a few extraneous files isn’t usually a problem, but try to avoid copying local directories full of dependencies like <code class="docutils literal notranslate"><span class="pre">vendor/bundle</span></code> or a virtualenv. The easiest way to do this is to make sure you use a <code class="docutils literal notranslate"><span class="pre">.dockerignore</span></code> file. It works like <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>.</p>
</section>
<section id="example-dockerfiles">
<h2>Example Dockerfiles<a class="headerlink" href="#example-dockerfiles" title="Permalink to this headline">¶</a></h2>
<p>For a Python WSGI app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.6</span>

<span class="n">COPY</span> <span class="o">.</span> <span class="o">/</span><span class="n">myapp</span><span class="o">/</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">myapp</span>
<span class="n">RUN</span> <span class="n">python3</span><span class="mf">.6</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pipenv</span>
<span class="n">RUN</span> <span class="n">pipenv</span> <span class="n">install</span> <span class="o">--</span><span class="n">system</span> <span class="o">--</span><span class="n">deploy</span>

<span class="n">EXPOSE</span> <span class="mi">5000</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;gunicorn&quot;</span><span class="p">,</span> <span class="s2">&quot;myapp.wsgi&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0:5000&quot;</span><span class="p">,</span> <span class="s2">&quot;-w&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>For a Rails app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ruby</span><span class="p">:</span><span class="mf">2.4</span>

<span class="n">COPY</span> <span class="o">.</span> <span class="o">/</span><span class="n">myapp</span><span class="o">/</span>
<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">myapp</span>
<span class="n">RUN</span> <span class="n">bundle</span> <span class="n">install</span>

<span class="n">EXPOSE</span> <span class="mi">3000</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;bundle&quot;</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;rails&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;3000&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Guides</a></h1>








<h3>Navigation</h3>
<p><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/a11y.html">Accessibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github_desktop.html">GitHub Desktop</a></li>
</ul>
<p><span class="caption-text">How We Work Together</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/code_review.html">Code review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/pairing.html">Pair programming</a></li>
</ul>
<p><span class="caption-text">Languages and Frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../languages/python.html">Python Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/rails.html">Rails at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/vuejs.html">Vue.js at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/wordpress.html">WordPress at MIT Libraries</a></li>
</ul>
<p><span class="caption-text">Authentication</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authentication/oauth.html">OAuth at MIT (deprecated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authentication/touchstone_saml.html">Touchstone / Shibboleth / SAML</a></li>
</ul>
<p><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy/airflow.html">Airflow: workflow engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/aws-2.0.html">AWS Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/cicd.html">Continuous Integration/Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/heroku.html">Heroku</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/heroku_checklist.html">Heroku Launch Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/legacy-aws.html">Legacy AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/legacy-terraform.html">Legacy Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/pantheon.html">Pantheon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/terraform-1.0.html">Terraform</a></li>
</ul>
<p><span class="caption-text">Everything else</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="adr.html">Architecture Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagrams.html">Diagramming Guidelines</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Containerizing Your App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dockerfile-guidelines">Dockerfile Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entrypoint-cmd">ENTRYPOINT/CMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dockerignore">.dockerignore</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-dockerfiles">Example Dockerfiles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exception_monitoring.html">Exception Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident_response.html">Incident Response Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Central Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="matomo.html">Configuring apps to use Matomo for analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy_urls.html">Proxy URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssl.html">SSL Encryption</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="diagrams.html" title="previous chapter">Diagramming Guidelines</a></li>
      <li>Next: <a href="exception_monitoring.html" title="next chapter">Exception Monitoring</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, MIT Libraries.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/misc/docker.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>