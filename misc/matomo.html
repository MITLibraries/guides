
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Configuring apps to use Matomo for analytics &#8212; Guides  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Proxy URLs" href="proxy_urls.html" />
    <link rel="prev" title="Central Logging" href="logging.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="configuring-apps-to-use-matomo-for-analytics">
<h1>Configuring apps to use Matomo for analytics<a class="headerlink" href="#configuring-apps-to-use-matomo-for-analytics" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://matomo.org">Matomo</a> (formerly piwik) is an open-source analytics
software. We prefer it to Googe Analytics due to its emphasis on user
privacy.</p>
<p>Our Matomo instance runs as a Docker container in Fargate. A repo with
the dockerfile and config is located on <a class="reference external" href="https://github.com/MITLibraries/docker-matomo">GitHub</a>.</p>
<p>This guide covers how to add Matomo tracking code to a web application.
For more in-depth information on using and developing Matomo, see the
<a class="reference external" href="https://matomo.org/help/">offical Matomo docs</a>. For information specific
to our implementation, such as config and how to access staging and prod, visit
the <a class="reference external" href="https://wikis.mit.edu/confluence/display/UXWS/Matomo+analytics">Matomo analytics</a> page in the UXWS Confluence.</p>
<section id="for-rails-applications-hosted-on-heroku">
<h2>For Rails applications hosted on Heroku<a class="headerlink" href="#for-rails-applications-hosted-on-heroku" title="Permalink to this headline">¶</a></h2>
<p>The tracking code is already included in the <a class="reference external" href="https://github.com/mitlibraries/mitlibraries-theme">mitlibraries-theme gem</a>. Assuming your app uses mitlibraries-theme, you can
activate tracking by adding the following environment variables to your
Heroku app:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MATOMO_URL</span></code> - the URL of the Matomo app you are connecting to. Make sure to include the trailing forward slash!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MATOMO_SITE_ID</span></code> - the ID of the measurable you are tracking. You can
find this in Matomo by going to Settings (gearbox icon in navbar) &gt; Websites &gt; Manage. The ID for each website will
appear underneath the website name.</p></li>
</ul>
</section>
<section id="for-the-wordpress-network-hosted-on-pantheon">
<h2>For the WordPress network hosted on Pantheon<a class="headerlink" href="#for-the-wordpress-network-hosted-on-pantheon" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/MITLibraries/mitlib-wp-network/tree/master/web/app/plugins/mitlib-analytics">mitlib-analytics plugin</a>
inserts Matomo tracking code into the network. The plugin has two config values – Matomo URL and Matomo property ID –
both of which can be set in the network admin console.</p>
<p>Note that we collect data for libraries.mit.edu and LibGuides in the same Matomo property, so these will use the same
property ID.</p>
</section>
<section id="for-libguides-and-another-libapps-products">
<h2>For LibGuides and another LibApps products<a class="headerlink" href="#for-libguides-and-another-libapps-products" title="Permalink to this headline">¶</a></h2>
<p>We track LibGuides on the same Matomo property as the WordPress network. Since there is no staging or dev environment in LibApps, we need to make the changes live in prod by adding/editing tracking code in the header.</p>
<p>The
<a class="reference external" href="https://github.com/MITLibraries/hosted-branding">hosted-branding repo</a> details how to modify LibApps headers. Once you
have made changes, make sure to check the updated header markup into the hosted-branding repo.</p>
<p>If you’d like to test changes before they go live, we have a
<a class="reference external" href="https://libguides.mit.edu/test-group">test group in LibGuides</a> that has its own header/footer and JS/CSS. The test
group has minimal content, but you should be able to discern whether tracking data is being sent to Matomo.</p>
</section>
<section id="for-static-sites">
<h2>For static sites<a class="headerlink" href="#for-static-sites" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/mitlibraries/mitlib-tf-workloads-libraries-website">mitlib-tf-workloads-libraries-website</a> repo
builds a CDN for static content. Typically, this is infrastructure is used for legacy sites like
<a class="reference external" href="https://github.com/MITLibraries/future-of-libraries-static">Future of Libraries</a>.</p>
<p>Matomo needs to be set up differently for these sites in order to accommodate the CSP directives for the CDN. As
described in <a class="reference external" href="https://matomo.org/faq/general/faq_20904/">this FAQ</a>, the tracking code should be loaded from the site’s
assets directory (rather than inline), and the client script should be loaded explicitly (rather than from the tracking
code).</p>
<p>For Future of Libraries, and likely for other static sites, these <code class="docutils literal notranslate"><span class="pre">script</span></code> tags will have to be added to the <code class="docutils literal notranslate"><span class="pre">head</span></code> of
each HTML file in the site. The best way we’ve found to do this is find/replace in your IDE, which feels adequate for a one-time process. If we find that we need to edit the script tags often, then a find/replace script may be useful.</p>
</section>
<section id="for-dspace-mit">
<h2>For DSpace&#64;MIT<a class="headerlink" href="#for-dspace-mit" title="Permalink to this headline">¶</a></h2>
<p>The DSpace&#64;MIT codebase is hosted on Atmire’s GitLab organization. In order to add or modify tracking code, you will
need a GitLab account. As of June 2023, the Digital Library Systems Manager is our point of contact with Atmire.</p>
<p><em>More details to be added once we’ve configured Matomo in DSpace&#64;MIT.</em></p>
</section>
<section id="for-dome">
<h2>For Dome<a class="headerlink" href="#for-dome" title="Permalink to this headline">¶</a></h2>
<p>TBD, pending migration of Dome to our AWS org.</p>
</section>
<section id="other-things-to-note">
<h2>Other things to note<a class="headerlink" href="#other-things-to-note" title="Permalink to this headline">¶</a></h2>
<p>We run a cron job as a scheduled ECS task to compile the raw data (more
info on this is available in the <a class="reference external" href="(https://github.com/MITLibraries/docker-matomo)">GitHub repo</a>.
If you are not seeing any data in the dashboard, something is probably
wrong with the cron job.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Guides</a></h1>








<h3>Navigation</h3>
<p><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics/a11y.html">Accessibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/github_desktop.html">GitHub Desktop</a></li>
</ul>
<p><span class="caption-text">How We Work Together</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/code_review.html">Code review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collaboration/pairing.html">Pair programming</a></li>
</ul>
<p><span class="caption-text">Languages and Frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../languages/python.html">Python Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/rails.html">Rails at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/vuejs.html">Vue.js at MIT Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages/wordpress.html">WordPress at MIT Libraries</a></li>
</ul>
<p><span class="caption-text">Authentication</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authentication/oauth.html">OAuth at MIT (deprecated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authentication/touchstone_saml.html">Touchstone / Shibboleth / SAML</a></li>
</ul>
<p><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy/airflow.html">Airflow: workflow engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/aws-2.0.html">AWS Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/cicd.html">Continuous Integration/Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/heroku.html">Heroku</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/heroku_checklist.html">Heroku Launch Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/legacy-aws.html">Legacy AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/legacy-terraform.html">Legacy Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/pantheon.html">Pantheon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/terraform-1.0.html">Terraform</a></li>
</ul>
<p><span class="caption-text">Everything else</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="adr.html">Architecture Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagrams.html">Diagramming Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Containerizing Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="exception_monitoring.html">Exception Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="incident_response.html">Incident Response Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Central Logging</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuring apps to use Matomo for analytics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#for-rails-applications-hosted-on-heroku">For Rails applications hosted on Heroku</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-the-wordpress-network-hosted-on-pantheon">For the WordPress network hosted on Pantheon</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-libguides-and-another-libapps-products">For LibGuides and another LibApps products</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-static-sites">For static sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-dspace-mit">For DSpace&#64;MIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-dome">For Dome</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-things-to-note">Other things to note</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="proxy_urls.html">Proxy URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssl.html">SSL Encryption</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="logging.html" title="previous chapter">Central Logging</a></li>
      <li>Next: <a href="proxy_urls.html" title="next chapter">Proxy URLs</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, MIT Libraries.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/misc/matomo.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>